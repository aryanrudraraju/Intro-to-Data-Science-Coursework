---
title: |
  | Introduction to Data Science
  | R exercises in-class
  | Week 5  
author: |
  | Dr. Gah-Yi Ban
  | Imperial College Business School

output:
  pdf_document: default
  html_document:
    df_print: paged
---

# Data Visualization (continued)

This tutorial covers data visualization skills and pipe operators.

Let's use `tidyverse` package to support `%>%` operators and `ggplot2` to support data visualization.

**NOTE:** if you don't have tidyverse and ggplot2 packages on your RStudio. Please install it by running `install.packages("tidyverse")` then `install.packages("ggplot2")` in the R Console.

```{r load lib, warning=F, message=F}
library(tidyverse)
library(ggplot2)
```

Before starting any practice and exercises, load the dataset "uk_gdp_and_weeklyWage.csv".

```{r load data}
uk_gdp_and_weeklyWage <- read.csv("uk_gdp_and_weeklyWage2.csv", 
                                  stringsAsFactors = F)


```

Next, add GDP growth rates and categorize the growth rate into quartiles. *NOTE:* there will be NA(s) in the GDP growth rates data

```{r mutate}

uk_gdp_and_weeklyWage <- uk_gdp_and_weeklyWage %>% 
  mutate(GDP_growth_rate = (GDP_m - lag(GDP_m)) / lag(GDP_m) * 100, 
         weeklyWageQuantile = cut(Weekly_pay, 
                                  quantile(Weekly_pay, 
                                           probs = seq(0, 1, 0.25), type = 7), 
                                  include.lowest = T, labels = F)
         )

uk_gdp_and_weeklyWage <- uk_gdp_and_weeklyWage %>% 
  mutate (GDP_growth_rate_Quantile = cut(GDP_growth_rate, 
                                  quantile(GDP_growth_rate, 
                                           probs = seq(0, 1, 0.25), type = 7, na.rm = T), 
                                  include.lowest = T, labels = F)
  )

uk_gdp_and_weeklyWage <- uk_gdp_and_weeklyWage %>% 
  mutate (GDP_per_cap = GDP_m/Population*1000000) # calculate GDP per Capita (£)

uk_gdp_and_weeklyWage <- uk_gdp_and_weeklyWage %>% 
  mutate (wage_level = Weekly_pay > 500) 


```

## Plot a histogram

To plot some data, we need to allocate the data for x-axis and y-axis and set them as the arguments for `aes` in the `ggplot` function, followed by the verbs provided by `ggplot2` package, for example, `geom_histogram`. To add each verb, `+` is required. An application of `ggplot` is shown in the following code chunk.

`geom_histogram` is used in this example for illustrating the distribution of the average weekly wages in a histogram. `bins` is for setting number of vertical bars, each of which shows how many values from the data fall into this range.

Run the following code chunk- a histogram will appear because of the use of `geom_histogram`.

```{r histogram weekly wage}
uk_gdp_and_weeklyWage %>% ggplot(aes(x=Weekly_pay)) + 
   geom_histogram( bins = 6)
```

Try the following code chunk with more settings in `geom_histogram` by changing the filling colour. The colours can be denoted by English words or HEX codes. For example, `red`, `lightblue`, `green`, `#FF0000`, `#ADD8E6`, `#00FF00`.

```{r histogram weekly wage1, fig.cap="UK Weekly Wage Plot"}
uk_gdp_and_weeklyWage %>% ggplot(aes(x=Weekly_pay)) + 
   geom_histogram( bins = 6, colour = "black", fill = "white")
```

The type of border lines of each histogram can be changed by an additional parameter `linetype`. In the following example, `linetype` is added and filling colour of each bar in the histogram is changed. Then a vertical line to represent mean of weekly wage is added by the verb `geom_vline` with the main parameter `xintercept=mean()`. Other parameters such as line colour, linetype and width can be used to define the vertical line as well.

```{r histogram weekly wage2}
uk_gdp_and_weeklyWage %>% ggplot(aes(x=Weekly_pay)) + 
   geom_histogram(bins = 6, colour = "black", fill = "lightblue", 
                  linetype = "dashed") +
    geom_vline(aes(xintercept=mean(Weekly_pay)),
            colour="blue", linetype="dashed", linewidth = 1)
```

Here is an example of how to further customise this plot. Run and study the code below, and try your own variations.

```{r}

# Create the plot
uk_gdp_and_weeklyWage %>% 
  ggplot(aes(x = Weekly_pay)) +
  geom_histogram(bins = 6, colour = "black", fill = "lightblue", alpha = 0.7) + # Adjust fill colour and transparency
  geom_vline(aes(xintercept = mean(Weekly_pay)),
             colour = "blue", linetype = "dashed", linewidth = 1) + # Adjust vline appearance
  labs(
    title = "Distribution of Weekly Wage",
    x = "Weekly Wage (£)",
    y = "Frequency"
  ) +
  theme_minimal() + # Use a minimal theme
  theme(
    plot.title = element_text(hjust = 0.5, size = 14, face = "bold"), # Adjust title appearance
    axis.text = element_text(size = 10), # Adjust axis text size
    axis.title = element_text(size = 12), # Adjust axis title size
    panel.grid.major = element_line(colour = "gray90"), # Adjust grid line colour
    panel.grid.minor = element_blank(), # Remove minor grid lines
    legend.position = "none" # Remove legend
  )

```

*Exercise 1*

Create a histogram of the GDP per capita with light green and dashed border lines, and a red dashed mean line with width 1.5.

```{r Exercise 1}



```

*Exercise 2*

Using a 7-bin histogram, plot the GDP in pink with a blue dashed mean line.

```{r Exercise 2}



```

## The End
